{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Carte d'accréditation — {{ card.name }}</title>
<style>
body {
    font-family: Arial, sans-serif;
    background: #f4f4f9;
    color: #333;
    text-align: center;
    padding: 30px;
}
.card {
    background: white;
    border-radius: 12px;
    padding: 25px;
    box-shadow: 0 0 15px rgba(0,0,0,0.1);
    max-width: 500px;
    margin: 0 auto;
}
.photo {
    width: 130px;
    height: 130px;
    object-fit: cover;
    border-radius: 50%;
    margin-bottom: 15px;
    border: 3px solid #007BFF;
}
.qr {
    width: 130px;
    margin-top: 15px;
}
h1 {
    font-size: 22px;
    color: #007BFF;
    margin-bottom: 10px;
}
p {
    line-height: 1.5;
}
.info, .signature, .history {
    text-align: left;
    margin-top: 20px;
}
.info p, .signature p, .history ul li {
    margin: 4px 0;
}
.status {
    font-weight: bold;
    color: green;
}
form {
    margin-top: 15px;
}
input[type="text"] {
    padding: 8px;
    width: 200px;
    border-radius: 5px;
    border: 1px solid #ccc;
}
button {
    padding: 8px 15px;
    border-radius: 5px;
    border: none;
    background: #007BFF;
    color: white;
    cursor: pointer;
}
button:hover { background: #0056b3; }
.error { color: red; margin-top: 10px; }
.contact-urgence {
    margin-top: 20px;
    font-size: 14px;
    color: #555;
    border-top: 1px solid #eee;
    padding-top: 10px;
}
</style>
</head>
<body>

<div class="card">
    {% if card.photo %}
        <img src="{{ card.photo.url }}" alt="Photo" class="photo">
    {% endif %}
    <h1>{{ card.name }}</h1>
    <p><strong>Carte d’accréditation virtuelle</strong></p>

    <p>
        Bienvenue ! Ceci est la carte d'identité virtuelle permettant d'identifier le propriétaire de cette carte.
        Toutes les informations personnelles sont protégées et visibles uniquement après saisie du code secret.
        Cette carte est validée par l'État et Cartes Connect Congo.
    </p>

    {% if not show_details %}
        <form method="post">
            {% csrf_token %}
            <input type="text" name="access_code" placeholder="Entrez le code secret" required>
            <button type="submit">Afficher les infos</button>
        </form>
        {% if error %}
            <p class="error">{{ error }}</p>
        {% endif %}
    {% else %}
        <div class="info">
            <p><strong>Nom complet :</strong> {{ card.name }}</p>
            {% if card.genre %}
                <p><strong>Genre :</strong> {{ card.genre }}</p>
            {% endif %}
            {% if card.role %}
                <p><strong>Rôle / Fonction :</strong> {{ card.role }}</p>
            {% endif %}
            {% if card.birth_date or card.birth_place %}
                <p><strong>Date / lieu de naissance :</strong>
                    {% if card.birth_date %}{{ card.birth_date|date:"d F Y" }}{% endif %}
                    {% if card.birth_place %} / {{ card.birth_place }}{% endif %}
                </p>
            {% endif %}
            {% if card.owner_address %}
                <p><strong>Adresse :</strong> {{ card.owner_address }}</p>
            {% endif %}
            {% if card.personal_phone %}
                <p><strong>Numéro personnel :</strong> {{ card.personal_phone }}</p>
            {% endif %}
            {% if card.email %}
                <p><strong>Email :</strong> {{ card.email }}</p>
            {% endif %}
            <p><strong>Émise le :</strong> {{ card.issued_at|date:"d F Y" }}</p>
            <p><strong>Valide jusqu’au :</strong> {{ card.expiration_date|date:"d F Y" }}</p>
            <p><strong>Statut :</strong>
                <span class="status">
                    {% if card.valid %}Valide{% else %}Expirée{% endif %}
                </span>
            </p>
        </div>

        <div class="signature">
            <p><strong>Consentement :</strong> {% if card.consent %}Oui{% else %}Non{% endif %}</p>
            {% if card.signature_date %}
                <p><strong>Date de signature :</strong> {{ card.signature_date|date:"d F Y" }}</p>
            {% endif %}
        </div>

        {% if card.scan_logs.exists %}
        <div class="history">
            <h3>Historique des scans</h3>
            <ul>
                {% for log in card.scan_logs.all %}
                    <li>{{ log.date|date:"d/m/Y H:i" }} — Scanné depuis {{ log.device|default:"Inconnu" }}</li>
                {% empty %}
                    <li>Aucun scan enregistré.</li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}
    {% endif %}

    <div class="contact-urgence">
        {% if card.emergency_phone %}
            <p><strong>Numéro d'urgence :</strong> {{ card.emergency_phone }}</p>
        {% endif %}
    </div>

    {% if card.qr_code %}
        <img src="{{ card.qr_code.url }}" alt="QR Code" class="qr">
    {% endif %}

    <p style="margin-top:15px;font-size:13px;color:#777;">
        Cette carte est nominative. Pour vérifier une autre carte, scannez son QR code.
    </p>
</div>

</body>
</html>
