{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Carte d'accréditation — {{ card.name }}</title>
<style>
body { font-family: Arial, sans-serif; background: #f4f4f9; color: #333; text-align: center; padding: 30px; }
.card { background: white; border-radius: 12px; padding: 25px; box-shadow: 0 0 15px rgba(0,0,0,0.1); max-width: 420px; margin: 0 auto; }
.photo { width: 130px; height: 130px; object-fit: cover; border-radius: 50%; margin-bottom: 15px; border: 3px solid #007BFF; }
.qr { width: 130px; margin-top: 15px; }
h1 { font-size: 22px; color: #007BFF; margin-bottom: 10px; }
p { font-size: 15px; line-height: 1.5; }
.info { text-align: left; margin-top: 20px; }
.info p { margin: 4px 0; }
.status { font-weight: bold; color: green; }
.signature { margin-top: 15px; font-size: 14px; color: #333; text-align: left; }
.signature p { margin: 4px 0; }
.history { text-align: left; background: #f9f9f9; padding: 10px; border-radius: 8px; margin-top: 20px; font-size: 13px; color: #555; }
.history h3 { margin-bottom: 8px; font-size: 15px; color: #007BFF; }
.code-form { margin-top: 20px; }
</style>
</head>
<body>
<div class="card">
    {% if card.photo %}
        <img src="{{ card.photo.url }}" alt="Photo" class="photo">
    {% endif %}

    <h1>Bienvenue sur MediaConnect Congo</h1>
    <p>Ceci est la carte d'identité virtuelle permettant d'identifier le propriétaire de cette carte.</p>

    <!-- Infos publiques visibles par tout le monde -->
    <p><strong>Genre :</strong> {{ card.genre|default:"Non renseigné" }}</p>
    <p><strong>Rôle :</strong> {{ card.role|default:"Non renseigné" }}</p>
    <p><strong>Numéro personnel :</strong> {{ card.personal_phone|default:"Non renseigné" }}</p>
    <p><strong>Email :</strong> {{ card.email|default:"Non renseigné" }}</p>
    <p><strong>Numéro d'urgence :</strong> {{ card.emergency_phone|default:"Non renseigné" }}</p>

    {% if card.qr_code %}
        <img src="{{ card.qr_code.url }}" alt="QR Code" class="qr">
    {% endif %}

    <!-- Formulaire pour le code secret -->
    <div class="code-form">
        <form method="post">
            {% csrf_token %}
            <label for="secret_code">Entrez le code secret pour voir les informations privées :</label><br>
            <input type="password" id="secret_code" name="secret_code" required>
            <button type="submit">Valider</button>
        </form>
        {% if error %}<p style="color:red;">{{ error }}</p>{% endif %}
    </div>

    <!-- Infos privées visibles après code -->
    {% if show_private %}
    <div class="info">
        <p><strong>Nom et prénom :</strong> {{ card.name }}</p>
        <p><strong>Date et lieu de naissance :</strong>
            {% if card.birth_date %}{{ card.birth_date|date:"d F Y" }}{% endif %}
            {% if card.birth_place %} / {{ card.birth_place }}{% endif %}
        </p>
        <p><strong>Adresse :</strong> {{ card.owner_address }}</p>
        <p><strong>Émise le :</strong> {{ card.issued_at|date:"d F Y" }}</p>
        <p><strong>Valide jusqu’au :</strong> {{ card.expiration_date|date:"d F Y" }}</p>
        <p><strong>Statut :</strong> {% if card.valid %}Valide{% else %}Expirée{% endif %}</p>
    </div>

    <div class="signature">
        <p><strong>Consentement :</strong> {% if card.consent %}Oui{% else %}Non{% endif %}</p>
        {% if card.signature_date %}
            <p><strong>Date de signature :</strong> {{ card.signature_date|date:"d F Y" }}</p>
        {% endif %}
    </div>

    {% if card.scan_logs.exists %}
    <div class="history">
        <h3>Historique des scans</h3>
        <ul>
            {% for log in card.scan_logs.all %}
                <li>{{ log.date|date:"d/m/Y H:i" }} — Scanné depuis {{ log.device|default:"Inconnu" }}</li>
            {% empty %}
                <li>Aucun scan enregistré.</li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}
    {% endif %}

    <p style="margin-top:15px;font-size:13px;color:#777;">
        Cette carte est nominative. Pour vérifier une autre carte, scannez son QR code.
    </p>
</div>
</body>
</html>
